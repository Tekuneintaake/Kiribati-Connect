<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-26D0BD4FT2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-26D0BD4FT2');
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Profile | Kiribati Connect</title>
  <link rel="icon" href="images/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="style/style.css">
</head>
<body>

  <!-- Top Bar (Kiribati Blue Header) -->
  <div class="top-bar">
    <div class="logo">Kiribati Connect</div>
  </div>

  <!-- Profile Content -->
  <div class="feed-container">
    <!-- Profile Card -->
    <div class="profile-card">
      <div class="profile-avatar" id="avatar">TK</div>
      <h2 class="profile-name" id="name">Tebwebwe Karawa</h2>
      <p class="profile-location" id="location">from Tarawa</p>
      <p class="profile-bio" id="bio">Proud to be IKiribati. Our ocean, our culture, our future.</p>
      <button class="btn btn-primary" onclick="toggleEditProfile()">Edit Profile</button>
    </div>

    <!-- Edit Profile Section -->
    <div id="edit-profile-section" class="section hidden">
      <h3 class="section-title">Edit Profile</h3>
      
      <div class="form-group">
        <label for="editName">Name</label>
        <input type="text" id="editName" placeholder="Your name">
      </div>
      
      <div class="form-group">
        <label for="editLocation">Location</label>
        <input type="text" id="editLocation" placeholder="Where you're from">
      </div>
      
      <div class="form-group">
        <label for="editBio">About You</label>
        <textarea id="editBio" placeholder="Tell us about yourself"></textarea>
      </div>
      
      <div class="form-group">
        <label for="profilePhoto">Profile Photo</label>
        <input type="file" id="profilePhoto" accept="image/*">
      </div>
      
      <button class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
      <button class="btn btn-secondary" onclick="toggleEditProfile()">Cancel</button>
    </div>

    <!-- Your Posts -->
    <div class="section">
      <h3 class="section-title">Your Posts</h3>
      <div id="user-posts">
        <div class="post">
          <div class="post-content">
            Proud to be IKiribati. Our ocean, our culture, our future. 
            Let's stay connected across the islands and around the world.
          </div>
          <div class="post-time">2 hours ago</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="index.html"><i class="fas fa-home"></i><span>Home</span></a>
    <a href="profile.html" class="active"><i class="fas fa-user"></i><span>Profile</span></a>
    <a href="messages.html"><i class="fas fa-envelope"></i><span>Messages</span></a>
    <a href="news.html"><i class="fas fa-newspaper"></i><span>News</span></a>
    <a href="#" onclick="toggleDropdown(); return false;"><i class="fas fa-cog"></i><span>Settings</span></a>
  </nav>

  <!-- Settings Modal -->
  <div class="dropdown-modal" id="settings-modal" style="display: none;">
    <div class="dropdown-modal-content">
      <h3>Settings</h3>
      <a href="profile-setup.html">Edit Profile</a>
      <a href="#" onclick="confirmLogout(); return false;">Log Out</a>
      <button class="close-btn">&times;</button>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Load current user
    let currentUser = JSON.parse(localStorage.getItem('currentUser')) || {
      name: 'Guest',
      avatar: '??',
      location: 'Unknown',
      bio: 'No bio yet',
      photo: null
    };

    function updateProfileDisplay() {
      const avatar = document.getElementById('avatar');
      const nameEl = document.getElementById('name');
      const locationEl = document.getElementById('location');
      const bioEl = document.getElementById('bio');

      nameEl.textContent = currentUser.name;
      locationEl.textContent = `from ${currentUser.location}`;
      bioEl.textContent = currentUser.bio;

      if (currentUser.photo) {
        avatar.style.backgroundImage = `url(${currentUser.photo})`;
        avatar.style.backgroundColor = 'transparent';
        avatar.textContent = '';
      } else {
        const initials = currentUser.name.split(' ').map(n => n[0]).join('').slice(0, 2).toUpperCase();
        avatar.style.backgroundImage = 'none';
        avatar.textContent = initials;
        const colors = ['#FDB813', '#D62828', '#003D79', '#006B3D'];
        const color = colors[currentUser.name.charCodeAt(0) % colors.length];
        avatar.style.backgroundColor = color;
      }
    }

    function toggleEditProfile() {
      const editSection = document.getElementById('edit-profile-section');
      editSection.classList.toggle('hidden');
      
      if (!editSection.classList.contains('hidden')) {
        document.getElementById('editName').value = currentUser.name;
        document.getElementById('editLocation').value = currentUser.location;
        document.getElementById('editBio').value = currentUser.bio;
      }
    }

    function saveProfile() {
      const newName = document.getElementById('editName').value.trim();
      const newLocation = document.getElementById('editLocation').value.trim();
      const newBio = document.getElementById('editBio').value.trim();
      
      if (!newName) {
        alert('Please enter your name');
        return;
      }
      
      currentUser.name = newName;
      currentUser.location = newLocation || 'Unknown';
      currentUser.bio = newBio || 'No bio yet';
      currentUser.avatar = newName.split(' ').map(n => n[0]).join('').slice(0, 2).toUpperCase();
      
      const fileInput = document.getElementById('profilePhoto');
      if (fileInput.files.length > 0) {
        const reader = new FileReader();
        reader.onload = function(e) {
          currentUser.photo = e.target.result;
          saveAndUpdate();
        };
        reader.readAsDataURL(file);
      } else {
        saveAndUpdate();
      }
    }
    
    function saveAndUpdate() {
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      updateProfileDisplay();
      toggleEditProfile();
      alert('Profile updated successfully!');
    }

    // Settings & Logout
    function toggleDropdown() {
      document.getElementById('settings-modal').style.display = 'flex';
    }

    document.querySelector('.close-btn').addEventListener('click', function() {
      document.getElementById('settings-modal').style.display = 'none';
    });

    window.addEventListener('click', function(e) {
      const modal = document.getElementById('settings-modal');
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });

    function confirmLogout() {
      if (confirm("Are you sure you want to log out?")) {
        alert("You have been logged out.");
        window.location.href = 'login.html';
      }
    }

    // Run on load
    document.addEventListener('DOMContentLoaded', function() {
      updateProfileDisplay();
    });
  </script>

<script>
  // Check if user is logged in when page loads
  document.addEventListener('DOMContentLoaded', function() {
    const currentUser = localStorage.getItem('currentUser');
    
    // If NOT logged in, redirect to login
    if (!currentUser || JSON.parse(currentUser).name === 'Guest') {
      window.location.href = 'login.html';
    }
  });
</script>
  
</body>
</html>
